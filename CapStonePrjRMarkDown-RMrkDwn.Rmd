---
title: "CapStnPrj-Exploratory"
author: "Rekha Vellanki"
date: "August 21, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```
library(ggplot2)

#1. Load each years datafile to a datastructure and replace any null values in columns with NA.

mydata15 <- read.csv("C:\\Users\\Rekha\\Documents\\REKHA\\DataScience\\SpringBoard\\CapStoneProject\\DATA\\CSV\\2015FE.csv",na.strings = c("", " ", "NA"))[-1]
mydata16 <- read.csv("C:\\Users\\Rekha\\Documents\\REKHA\\DataScience\\SpringBoard\\CapStoneProject\\DATA\\CSV\\2016FE.csv",na.strings = c("", " ", "NA"))[-1]
mydata17 <- read.csv("C:\\Users\\Rekha\\Documents\\REKHA\\DataScience\\SpringBoard\\CapStoneProject\\DATA\\CSV\\2017FE.csv",na.strings = c("", " ", "NA"))[-1]
mydata18 <- read.csv("C:\\Users\\Rekha\\Documents\\REKHA\\DataScience\\SpringBoard\\CapStoneProject\\DATA\\CSV\\2018FE.csv",na.strings = c("", " ", "NA"))[-1]


#2. Load function that combines datastructures with different number of columns                       
rbind.all.columns <- function(x, y) {
  
  x.diff <- setdiff(colnames(x), colnames(y))
  y.diff <- setdiff(colnames(y), colnames(x))
  
  x[, c(as.character(y.diff))] <- NA
  
  y[, c(as.character(x.diff))] <- NA
  
  return(rbind(x, y))
}



#!apply (is.na(mydata15), 2, all)
#3. Remove columns with all missing/null values
mydata15c <- mydata15[, !apply(is.na(mydata15), 2, all)]
mydata16c <- mydata16[, !apply(is.na(mydata16), 2, all)]
mydata17c <- mydata17[, !apply(is.na(mydata17), 2, all)]
mydata18c <- mydata18[, !apply(is.na(mydata18), 2, all)]
#mydata19c <- mydata19[, !apply(is.na(mydata19), 2, all)]


#4. combine the dataframes
mydata1516c <- rbind.all.columns(mydata15c, mydata16c)
mydata1718c <- rbind.all.columns(mydata17c, mydata18c)
mydataf <-  rbind.all.columns(mydata1516c, mydata1718c)

#5. Remove columns that are not needed
mydatafc <- mydataf[, -c(13:18, 24, 30:32, 39:44, 47:65, 75:80, 88:103, 106:108, 119:122, 128:129)]


# cleanup(remove/delete) datastructures not needed
rm(mydata15)
rm(mydata16)
rm(mydata17)
rm(mydata18)

#rm(mydata15c)
#rm(mydata16c)
#rm(mydata17c)
#rm(mydata18c)


# check the cleaned data
#write.csv(mydatafc, "C:\\Users\\Rekha\\Documents\\REKHA\\DataScience\\SpringBoard\\CapStoneProject\\DATA\\CSV\\mydatafc.csv")

# change colnames for easy use
colnames(mydatafc)[2]<- c("Mfrname")
colnames(mydatafc)[5]<- c("Mfrcd")


colnames(mydatafc)[1]<- c( "ModelYear")                                                                                              
colnames(mydatafc)[2]<- c( "Mfrname")                                                                                                 
colnames(mydatafc)[6]<- c( "ModelTypeIndex")                                                                                
colnames(mydatafc)[7]<- c( "EngDispl")                                                                                               
colnames(mydatafc)[8]<- c( "Cylinders")                                                                                                  
#colnames(mydatafc)[9]<- c( "Transmission"                                                                                            
colnames(mydatafc)[10]<- c( "CityFuel")                                                                     
colnames(mydatafc)[11]<- c( "HwyFuel")                                                                      
colnames(mydatafc)[12]<- c( "CombFuel")                                                                     
#colnames(mydatafc)[13]<- c( "Guzzler."                                                                                                
colnames(mydatafc)[14]<- c( "AirAspirMethod")                                                                                        
colnames(mydatafc)[15]<- c( "AirAspirMethodDesc")                                                                              
colnames(mydatafc)[16]<- c( "Trans")                                                                                                   
colnames(mydatafc)[17]<- c( "TransDesc")    

colnames(mydatafc)[18]<- c( "Gears")                                                                                                
colnames(mydatafc)[19]<- c( "LockupTorqueConverter")                                                                                 
colnames(mydatafc)[20]<- c( "TransCreeperGear")                                                                                      
colnames(mydatafc)[21]<- c( "DriveSys")                                                                                               
colnames(mydatafc)[22]<- c( "DriveDesc")                                                                                              
colnames(mydatafc)[23]<- c( "FuelUsageFuel")                                                                         
colnames(mydatafc)[24]<- c( "FuelUsageDesc")                                                                    
colnames(mydatafc)[25]<- c( "FuelUnit")                                                                           
colnames(mydatafc)[26]<- c( "FuelUnitDesc")                                                                      
colnames(mydatafc)[27]<- c( "GasGuzzlerExempt")                                          
colnames(mydatafc)[28]<- c( "GasGuzzlerExemptDesc")                                     
colnames(mydatafc)[29]<- c( "AnnualFuelCost")                                                                   
colnames(mydatafc)[30]<- c( "EPAAnnualFuelCost")
colnames(mydatafc)[31]<- c( "DescriptorModelType")                                                               
colnames(mydatafc)[32]<- c( "IntakeValves")                                                                                   
colnames(mydatafc)[33]<- c( "ExhaustValves")                                                                                  
colnames(mydatafc)[34]<- c( "CarlineClass")                                                                                           
colnames(mydatafc)[35]<- c( "CarlineClassDesc")                                                                                      
colnames(mydatafc)[36]<- c( "CarTruckCategory")                                                            
colnames(mydatafc)[37]<- c( "CalcApproachDesc")                                                                                      
colnames(mydatafc)[38]<- c( "ReleaseDate")                                                                                            
colnames(mydatafc)[39]<- c( "EPAFELabelID")                                                                                 
colnames(mydatafc)[40]<- c( "CommentsMfr")                                                                                 
colnames(mydatafc)[41]<- c( "CylDeact")                                                                                              
colnames(mydatafc)[42]<- c( "CylDeactDesc")                                                                                          
colnames(mydatafc)[43]<- c( "VarValTiming")                                                                                       
colnames(mydatafc)[44]<- c( "VarValTimingDesc")                                                                                  
colnames(mydatafc)[45]<- c( "VarValLift")                                                                                         
colnames(mydatafc)[46]<- c( "VarValLiftDesc")                                                                                     
colnames(mydatafc)[47]<- c( "FuelMtrSysCd")                                                                                    
colnames(mydatafc)[48]<- c( "FuelMtrSysDesc")                                                                                 
colnames(mydatafc)[49]<- c( "OilViscosity")                                                                                           
colnames(mydatafc)[50]<- c( "StopStartSysCd")                                                       
colnames(mydatafc)[51]<- c( "StopStartSysDesc")                                               
colnames(mydatafc)[52]<- c( "ModelTypeDesc")                                                                           
colnames(mydatafc)[53]<- c( "MFRCalcGasGuzzlerMPG")                                                                          
colnames(mydatafc)[54]<- c( "FERating")                                                                        
colnames(mydatafc)[55]<- c( "GHGRating")                                                                     
colnames(mydatafc)[56]<- c( "GHGRatingEPA")                                                             
colnames(mydatafc)[57]<- c( "SmogRatingTestGrp")                                                                              
colnames(mydatafc)[58]<- c( "MfrSmogRating")                                    
colnames(mydatafc)[59]<- c( "Savingsfuelcosts5yrs")                           
colnames(mydatafc)[60]<- c( "Spentfuelcosts5yrs")               
colnames(mydatafc)[61]<- c( "CityCO2Adj")                                                                               
colnames(mydatafc)[62]<- c( "HwyCO2Adj")                                                                                
colnames(mydatafc)[63]<- c( "CombCO2Adj")


```

## Including Plots

You can also embed plots, for example:

```{echo=FALSE}
 #### Data visualizations

# distribution of some of the variables in the dataset

#1. Trans

ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = Trans))

#2. Eng

ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = EngDispl))


##. Size

#ggplot(data = mydatafc) +
#  geom_bar(mapping = aes(x = EngDispl))

#3. cylinders

ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = Cylinders))


ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = Mfrname))



#3. Gears

ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = Gears))

#4. DriveSys

ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = DriveSys))

ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = CarlineClassDesc))




ggplot(data = mydatafc) +
  geom_bar(mapping = aes(x = CityFuel))


# impact of cylinders on cityfuel 

ggplot(mydatafc, aes(x = Cylinders, y = CityFuel)) +
     geom_point() +
     geom_smooth()

#ggplot(data = mydatafc, mapping = aes(x = Cylinders, y = ..density..)) + 
 # geom_freqpoly(mapping = aes(colour = CityFuel), binwidth = 50)

#ggplot(data = mydatafc, mapping = aes(x = Cylinders, y = CityFuel)) +
 # geom_boxplot()

# impact of transmission type on cityfuel 
ggplot(data = mydatafc, mapping = aes(x = Trans, y = CityFuel)) +
  geom_boxplot()

# mftname and cityfuel
ggplot(data = mydatafc) +
  geom_boxplot(mapping = aes(x = reorder(Mfrname, CityFuel, FUN = median), y = CityFuel)) +
  coord_flip()

# carlineclassdesc and cityfuel
ggplot(data = mydatafc) +
  geom_boxplot(mapping = aes(x = reorder(CarlineClassDesc, CityFuel, FUN = median), y = CityFuel)) +
  coord_flip()

# impact of DriveSys on cityfuel 


ggplot(mydatafc, aes(x = DriveSys, y = CityFuel)) +
  geom_point() +
  geom_smooth() +
  coord_flip()
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
